<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Iniciar Sesión</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0 shrink-to-fit=no, maximum-scale=1, user-scalable=no">

    {{!-- GOOGLE FONTS --}}
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
    {{!-- BOOTSTRAP 4 --}}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/flatly/bootstrap.min.css" integrity="sha384-qF/QmIAj5ZaYFAeQcrQ6bfVMAh4zZlrGwTPY7T/M+iTTLJqJBJjwwnsE5Y0mV7QK" crossorigin="anonymous">
    <!--link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"-->
    {{!-- JQUERY Ui--}}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
    
    {{!<link rel="stylesheet" href="/resources/demos/style.css">}}
    {{!-- FONT AWESOME 5 --}}
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    {{!-- STYLES --}}
    <link rel="stylesheet" href="/css/home-style.css">
    {{!-- BOOTSTRAP TABLE --}}
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css">
    {{!-- GOOGLE RECAPTCHA --}}
    <script src="https://www.google.com/recaptcha/api.js?render={{public_key}}"></script>
    {{>partial_loader_style}}
</head>

<body>
    {{>partial_loader_body}}
    <div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
        <header class="masthead mb-auto">
            <div class="inner">
                <nav class="nav nav-masthead justify-content-center">
                    <a class="nav-link active ml-auto" href="/login">Iniciar Sesión</a>
                </nav>
            </div>
        </header>

        <main role="main" class="inner cover">
            <h1 class="cover-heading">Solicita un acceso</h1>
            <p class="lead">Ingresa tu correo electrónico para solicitar un acceso.</p>
            <form id="form-signup">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="email-addon">@</span>
                    <input class="form-control" id="email" name="email" type="email" placeholder="Ingresa tu correo electrónico" required="required" aria-describedby="email-addon">
                    <div class="input-group-append">
                        <button type="submit" class="form-control btn-primary">Signup</button>
                    </div>
                </div>
            </form>
            <p>Si ya tienes una cuenta pueder iniciar sesión aquí.</p>
            <a class="btn btn-outline-success float-right" href="/login">Iniciar Sesión</a>

            <p class="lead">
                <!-- a href="#" class="btn btn-lg btn-secondary">Learn more</a-->
                {{> partial_messages}}
                {{> partial_errors}}
            </p>
        </main>

        <footer class="mastfoot mt-auto">
            <div class="inner">
                <small style="opacity:.17;">Desarrollado por <a href="#">hacarapi</a></small>
            </div>
        </footer>

        <div id="dialog-message" class="dialog-message"></div>
    </div>

    {{!-- SCRIPTS --}}
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    {{!-- JQUERY Ui--}}
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
    
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>

    <script>        
        $('#email').val('');

        $("#form-signup").submit(function (event) {
            event.preventDefault();
            runCaptcha();
        });

        function runCaptcha() {
            grecaptcha.execute('{{public_key}}', { action: '/signup' }).then(function (token) {
                const email = $('#email').val();
                const captcha = token;
                sendData(email, captcha);
            });
        };

        function sendData(email, captcha) {
            const info = JSON.stringify({ email: email, captcha: captcha });
            fetch('/signup', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: info
            }).then(
                res => res.json()
            ).then(data => {
                //console.log("messsge: " + data.message + ", score: " + data.score);
                var dlg = $("#dialog-message");
                $("#dialog-message").dialog({
                    resizable: false,
                    height: "auto",
                    width: 400,
                    modal: true,
                    title: data.title,
                    buttons: {
                        "Aceptar": function () {
                            if (data.redirect) {
                                window.location.href = data.redirect;
                            }
                            $(this).dialog("close");
                        }
                    }
                });
                $("#dialog-message").html(                    
                    `<p><span class="fa fa-2x fa-question-circle" style="float:left; margin:12px 12px 20px 0;"></span><br>${data.message}</p>`
                );
                $("#dialog-message").dialog("open");
            });
        }
    </script>
    {{>partial_loader_script}}
    
</body>

</html>